<?xml version="1.0"?>
<launch>
	<!-- Include the MAVROS node -->
	<!--include file="$(find px4_realsense_bridge)/launch/bridge_mavros.launch">
	</include-->
	<arg name="ns" default="/"/>
	<arg name="fcu_url" default="/dev/ttyTHS1:921600"/>
	<!--arg name="gcs_url" default="udp://@100.66.93.211:14550" /-->   <!-- GCS link is provided by SITL -->
	<!--arg name="gcs_url" default="udp://@10.42.0.100:14550" /-->   <!-- GCS link is provided by SITL -->
	<arg name="gcs_url" default="udp://@$(optenv GROUNDSTATION_IP):14550" />   <!-- GCS link is provided by SITL -->
	<arg name="tgt_system" default="1" />
	<arg name="tgt_component" default="1" />
	
	<!-- Launch realsense bridge -->
	<include file="$(find px4_realsense_bridge)/launch/bridge.launch" >
	</include>

	<!-- Launch MavROS -->
	<group ns="$(arg ns)">
		<include file="$(find mavros)/launch/node.launch">
			<arg name="pluginlists_yaml" value="$(find offboard_py)/resource/px4_pluginlists.yaml" />
			<!-- Need to change the config file to get the tf topic and get local position in terms of local origin -->
			<arg name="config_yaml" value="$(find offboard_py)/resource/px4_config.yaml" />
			<arg name="fcu_url" value="$(arg fcu_url)" />
			<arg name="gcs_url" value="$(arg gcs_url)" />
			<arg name="tgt_system" value="$(arg tgt_system)" />
			<arg name="tgt_component" value="$(arg tgt_component)" />
		</include>
	</group>


	<!-- Our node to control the drone -->
	<node pkg="offboard_py" type="rob498_drone.py" name="rob498_drone_py" required="true" output="screen" />
	<node pkg="offboard_py" type="imx219_publish.py" name="imx219_publish_py" required="true" output="screen" />

    <!-- rviz -->
    <!-- node type="rviz" name="rviz" pkg="rviz" args="-d $(find offboard_py)/rviz/offboard.rviz" / -->

	<!-- ct4 stuff -->
	<node name="pose_to_tf" pkg="offboard_py" type="tf_pub.py" output="screen"/>
	<node name="obstacle_detector" pkg="offboard_py" type="obstacle_detection.py" output="screen"/>

	<!-- Publish a static transformation between base_link and camera_odom_frame -->
	<node pkg="tf" type="static_transform_publisher" name="base_link_to_imx219"
			args="0 0 0 0 -1.5707 1.5707 base_link imx219 1000"/>

	<node name="tracker" pkg="offboard_py" type="tracker.py" output="screen"/>
</launch>
